#!/bin/sh

# Get the Minecraft version and server name from the script arguments
VERSION=$1
SERVER_NAME=$2

# Create server directory if it doesn't exist
mkdir -p ~/minecraft-server
cd ~/minecraft-server

# Download Minecraft server JAR file if it doesn't exist
if [ ! -f "minecraft_server.${VERSION}.jar" ]; then
    wget https://launcher.mojang.com/v1/objects/YOUR_SERVER_JAR_HASH/minecraft_server.${VERSION}.jar
fi

# Generate SHA-1 hash of the JAR file
JAR_HASH=$(sha1sum minecraft_server.${VERSION}.jar | awk '{ print $1 }')

# Accept the EULA
echo "eula=true" > eula.txt

# Create or update server properties
cat <<EOL > server.properties
server-name=${SERVER_NAME}
server-port=25565
motd=A Minecraft Server
max-players=20
EOL

# Start the server
java -Xmx1024M -Xms1024M -jar minecraft_server.${VERSION}.jar nogui &

# Fetch the public IP address
PUBLIC_IP=$(curl -s http://checkip.amazonaws.com)

echo "Server started with JAR hash: ${JAR_HASH}"
echo "Server IP: ${PUBLIC_IP}"
